<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Blood Pressure</title>
    <meta name="description" content="Jak żyć?">
    <meta name="author" content="Karol">

    <link rel="stylesheet" href="css/styles.css?v=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>


</head>

<body>
    <div class="text-center">
        <h1>Pomiary Ciśnienia</h1>
        <div style="width: 80%; margin-left: 10%">
            <table class="table" id="table2">
                <thead class="thead-dark">
                    <tr id="tableColumns">
                        <th scope="col">Data</th>
                        <th scope="col">Pomiar</th>
                    </tr>
                    <tr>
                        <td scope="col" id="day-3">day-3</th>
                        <td scope="col" id="measurement-3">Nie zmierzono</th>
                    </tr>
                    <tr>
                        <td scope="col" id="day-2">day-2</th>
                        <td scope="col" id="measurement-2">Nie zmierzono</th>
                    </tr>
                    <tr>
                        <td scope="col" id="day-1">day-1</th>
                        <td scope="col" id="measurement-1">Nie zmierzono</th>
                    </tr>
                    <tr class="table-primary">
                        <td scope="col" id="day0">day0</th>
                        <td scope="col" id="measurement0">Naciśnij aby dodać pomiar</th>
                    </tr>
                </thead>
            </table>
            <br>
        </div>

        <!-- <script src="js/scripts.js"></script> -->
        <script>
            class BloodPressure {
                constructor(userPressure, userDate) {
                    this.userPressure = userPressure;
                    this.userDate = userDate;
                }
            }

            function formatDate(date) {
                var day = date.getDate();
                if (day < 10) { day = "0" + day.toString(10) }
                var monthIndex = date.getMonth();
                if (monthIndex < 10) { monthIndex = "0" + monthIndex.toString(10) }
                var year = date.getFullYear();
                return year + "-" + monthIndex + "-" + day;
            }

            var date = new Date();
            var today = date.getDate();
            var dayOfWeek = date.getDay();
            var days = ["Niedziela", "Poniedziałek", "Wtorek", "Środa", "Czwartek", "Piątek", "Sobota"]

            var msrObject = document.querySelector("#measurement0");
            var dateCalendarFormat = formatDate(date);
            var todaysBloodPressure;

            msrObject.addEventListener("click", function () {
                var re = new RegExp('ab+c');
                var userInput = prompt("Podaj dzisiejsze ciśnienie");
                msrObject.innerHTML = userInput;
                todaysBloodPressure = new BloodPressure(userInput, dateCalendarFormat);
                storePressure(todaysBloodPressure);
            });
            function mod(n, m) {
                return ((n % m) + m) % m;
            }
            function fillTable() {
                var date = new Date();

                document.querySelector("#day0").innerHTML = date.getDate().toString(10) + " " + days[mod(dayOfWeek, 7)] + " (Dzisiaj)";
                document.querySelector("#day-1").innerHTML = (date.getDate() - 1).toString(10) + " " + days[mod(dayOfWeek - 1, 7)];
                document.querySelector("#day-2").innerHTML = (date.getDate() - 2).toString(10) + " " + days[mod(dayOfWeek - 2, 7)];
                document.querySelector("#day-3").innerHTML = (date.getDate() - 3).toString(10) + " " + days[mod(dayOfWeek - 3, 7)];

            }

            fillTable();

            function storePressure(param1) {
                // Put the object into storage
                localStorage.setItem('storedObject2', JSON.stringify(param1));
            }

            function getStoredPressure() {
                // Retrieve the object from storage
                var retrievedObject = localStorage.getItem('storedObject2');
                return retrievedObject;
            }

            var parsedJSON;
            function jsonToBloodPressure(jsonFile) {
                parsedJSON = JSON.parse(jsonFile);
                return parsedJSON;
            }
            var savedValues = jsonToBloodPressure(getStoredPressure());
            tableOfPressures = new Array();
            for (var x = 0; x < tableOfPressures.length; x++){

            }
            function fillPreviousDays(){
                if (dateCalendarFormat==savedValues.userDate){
                    msrObject.innerHTML=savedValues.userPressure;
                }
                var dayX = savedValues.userDate.charAt(8)+savedValues.userDate.charAt(9);
                dayX=parseInt(dayX, 10);
                if ((date.getDate() -1 ) == dayX) {
                    document.querySelector("#measurement-1").innerHTML= savedValues.userPressure;
                }
                if ((date.getDate() -2 ) == dayX) {
                    document.querySelector("#measurement-2").innerHTML= savedValues.userPressure;
                }
                if ((date.getDate() -3 ) == dayX) {
                    document.querySelector("#measurement-3").innerHTML= savedValues.userPressure;
                }

            }
            fillPreviousDays()
        </script>
</body>

</html>
